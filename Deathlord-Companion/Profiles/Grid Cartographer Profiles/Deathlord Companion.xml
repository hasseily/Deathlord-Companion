<?xml version="1.0" encoding="UTF-8" ?>
<gamelink>

	<card
		title="DEATHLORD COMPANION"
		short="DEATHLORD COMPANION"
		titlelo="Deathlord Companion"
		beta="true"
		rev="2"
	/>

	<author><![CDATA[Rikkles]]></author>

	<dsub>

    <!-- Deathlord Companion version 1 -->
    <detect system="APPLE II" sys="40a3f909" prg="8ce1a6e3" ph3="8ce1a6e3" ph2="1" ph1="0" ph0="0">
      <!-- 0:mapID 1:region 2:maptype 3:xpos 4:ypos 5:overland_submap_xx 6:overland_submap_yy -->
      <!-- The overland map is a stitched up 16x16 of 64x64 submaps using 8 overlapping margin tiles, with 5 and 6 -->
      <!-- above being their x and y coords in the supermap. Here we merge 4 submaps at a time, with 16 levels of 200x200 maps -->
      <!-- Note that for this to work, the x and y coords have been pre-processed in Deathlord Companion using -->
      <!-- this function (here for x): peek->data[3] = peek->data[3] + (p_sysmem[0xFC4B] % 4)*56; -->
			<peek bytes="FC4E 0000 FC04 FC06 FC07 FC4B FC4C" />
		</detect>

	</dsub>

	<regions>
		<region id="1" name="Lorn" ground_floor="true" start_floor="F1" auto_create="true" >
			<grid width="58" height="58" tilex="4" tiley="4" repeating="false" origin_tl="true" />
		</region>
    <region id="2" name="Town 1" ground_floor="true" start_floor="G" auto_create="true" >
      <grid width="16" height="16" tilex="4" tiley="4" repeating="false" origin_tl="true" />
    </region>
    <region id="3" name="Castle 2" ground_floor="true" start_floor="G" auto_create="true" >
      <grid width="16" height="16" tilex="4" tiley="4" repeating="false" origin_tl="true" />
    </region>
    <region id="4" name="Town 3" ground_floor="true" start_floor="G" auto_create="true" >
      <grid width="16" height="16" tilex="4" tiley="4" repeating="false" origin_tl="true" />
    </region>
    <region id="5" name="Ruin 4" ground_floor="true" start_floor="G" auto_create="true" >
      <grid width="16" height="16" tilex="4" tiley="4" repeating="false" origin_tl="true" />
    </region>
    <region id="6" name="Town 5" ground_floor="true" start_floor="G" auto_create="true" >
      <grid width="16" height="16" tilex="4" tiley="4" repeating="false" origin_tl="true" />
    </region>
    <region id="7" name="Tokushima" ground_floor="true" start_floor="G" auto_create="true" >
      <grid width="16" height="16" tilex="4" tiley="4" repeating="false" origin_tl="true" />
    </region>
    <region id="8" name="Tower of Shumi" ground_floor="true" start_floor="G" auto_create="true" >
      <grid width="16" height="16" tilex="4" tiley="4" repeating="false" origin_tl="true" />
    </region>
    <region id="9" name="Fort Wintergreen" ground_floor="true" start_floor="G" auto_create="true" >
      <grid width="16" height="16" tilex="4" tiley="4" repeating="false" origin_tl="true" />
    </region>
    <region id="10" name="Palace Dungeons" ground_floor="false" start_floor="B1" auto_create="true" >
      <grid width="16" height="16" tilex="4" tiley="4" repeating="false" origin_tl="true" />
    </region>
	</regions>

	<views>
    <class name="Towers" tag="TR">
      <!-- Max 3 groups of 4 floors, starting at 2 and going to 0 -->
      <xpos offset="3" length="1" min="0" max="ff" />
      <ypos offset="4" length="1" min="0" max="ff" />
      <floor offset="2" length="1" adjust="-2" dir="down" />
    </class>
    <class name="Dungeons" tag="DUN">
      <!-- Max 3 groups of 4 floors, starting at 2 and going to 0 -->
      <xpos offset="3" length="1" min="0" max="ff" />
      <ypos offset="4" length="1" min="0" max="ff" />
      <floor offset="2" length="1" adjust="-2" dir="up" />
    </class>
    <class name="Towns" tag="TN">
      <!-- Floor as "0" opposed to the overworld with "1" -->
      <xpos offset="3" length="1" min="0" max="ff" />
      <ypos offset="4" length="1" min="0" max="ff" />
      <check offset="2" length="1" value="0" />
      <const_floor>G</const_floor>
    </class>
		<class name="Overworld" tag="OW">
      <!-- Floor is "1", which defines it from towns -->
      <!-- MapId is irrelevant, only X and Y submaps -->
      <xpos offset="3" length="1" min="0" max="ff" />
			<ypos offset="4" length="1" min="0" max="ff" />
      <check offset="2" length="1" value="1" />
    </class>


    <!-- Town 1 -->
    <packetview extends="Towns" region="2" tag="T01">
      <check offset="0" length="1" value="1b" />
    </packetview>
    <!-- Castle 2 -->
    <packetview extends="Towns" region="3" tag="T02">
      <check offset="0" length="1" value="19" />
    </packetview>
    <!-- Town 3 -->
    <packetview extends="Towns" region="4" tag="T03">
      <check offset="0" length="1" value="09" />
    </packetview>
    <!-- Ruin 4 -->
    <packetview extends="Towns" region="5" tag="T04">
      <check offset="0" length="1" value="33" />
    </packetview>
    <!-- Town 5 -->
    <packetview extends="Towns" region="6" tag="T05">
      <check offset="0" length="1" value="08" />
    </packetview>
    <!-- Tokushima -->
    <packetview extends="Towns" region="7" tag="T06">
      <check offset="0" length="1" value="28" />
    </packetview>
    <!-- Tower of Shumi -->
    <packetview extends="Towers" region="8" tag="T07">
      <check offset="0" length="1" value="2c" />
    </packetview>
    <!-- Fort Wintergreen -->
    <packetview extends="Towns" region="9" tag="T08">
      <check offset="0" length="1" value="0e" />
    </packetview>
    <!-- Palace Dungeons -->
    <packetview extends="Dungeons" region="10" tag="T09">
      <check offset="0" length="1" value="19" />
    </packetview>

    <!-- Overworld needs to be last, as a "catchall" -->
    <!-- when no town or dungeon has been found      -->
    <!-- Lorn (Overworld) -->
    <packetview extends="Overworld" region="1" tag="TOW01">
      <check offset="5" length="1" value="4" op="LT" />
      <check offset="6" length="1" value="4" op="LT" />
      <const_floor>F1</const_floor>
    </packetview>
    <packetview extends="Overworld" region="1" tag="TOW02">
      <check offset="5" length="1" value="8" op="LT" />
      <check offset="6" length="1" value="4" op="LT" />
      <const_floor>F2</const_floor>
    </packetview>
    <packetview extends="Overworld" region="1" tag="TOW03">
      <check offset="5" length="1" value="12" op="LT" />
      <check offset="6" length="1" value="4" op="LT" />
      <const_floor>F3</const_floor>
    </packetview>
    <packetview extends="Overworld" region="1" tag="TOW04">
      <check offset="5" length="1" value="16" op="LT" />
      <check offset="6" length="1" value="4" op="LT" />
      <const_floor>F4</const_floor>
    </packetview>
    <packetview extends="Overworld" region="1" tag="TOW05">
      <check offset="5" length="1" value="4" op="LT" />
      <check offset="6" length="1" value="8" op="LT" />
      <const_floor>F5</const_floor>
    </packetview>
    <packetview extends="Overworld" region="1" tag="TOW06">
      <check offset="5" length="1" value="8" op="LT" />
      <check offset="6" length="1" value="8" op="LT" />
      <const_floor>F6</const_floor>
    </packetview>
    <packetview extends="Overworld" region="1" tag="TOW07">
      <check offset="5" length="1" value="12" op="LT" />
      <check offset="6" length="1" value="8" op="LT" />
      <const_floor>F7</const_floor>
    </packetview>
    <packetview extends="Overworld" region="1" tag="TOW08">
      <check offset="5" length="1" value="16" op="LT" />
      <check offset="6" length="1" value="8" op="LT" />
      <const_floor>F8</const_floor>
    </packetview>
    <packetview extends="Overworld" region="1" tag="TOW09">
      <check offset="5" length="1" value="4" op="LT" />
      <check offset="6" length="1" value="12" op="LT" />
      <const_floor>F9</const_floor>
    </packetview>
    <packetview extends="Overworld" region="1" tag="TOW10">
      <check offset="5" length="1" value="8" op="LT" />
      <check offset="6" length="1" value="12" op="LT" />
      <const_floor>F10</const_floor>
    </packetview>
    <packetview extends="Overworld" region="1" tag="TOW11">
      <check offset="5" length="1" value="12" op="LT" />
      <check offset="6" length="1" value="12" op="LT" />
      <const_floor>F11</const_floor>
    </packetview>
    <packetview extends="Overworld" region="1" tag="TOW12">
      <check offset="5" length="1" value="16" op="LT" />
      <check offset="6" length="1" value="12" op="LT" />
      <const_floor>F12</const_floor>
    </packetview>
    <packetview extends="Overworld" region="1" tag="TOW13">
      <check offset="5" length="1" value="4" op="LT" />
      <check offset="6" length="1" value="16" op="LT" />
      <const_floor>F13</const_floor>
    </packetview>
    <packetview extends="Overworld" region="1" tag="TOW14">
      <check offset="5" length="1" value="8" op="LT" />
      <check offset="6" length="1" value="16" op="LT" />
      <const_floor>F14</const_floor>
    </packetview>
    <packetview extends="Overworld" region="1" tag="TOW15">
      <check offset="5" length="1" value="12" op="LT" />
      <check offset="6" length="1" value="16" op="LT" />
      <const_floor>F15</const_floor>
    </packetview>
    <packetview extends="Overworld" region="1" tag="TOW16">
      <check offset="5" length="1" value="16" op="LT" />
      <check offset="6" length="1" value="16" op="LT" />
      <const_floor>F16</const_floor>
    </packetview>
  </views>

</gamelink>
